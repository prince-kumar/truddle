{"ast":null,"code":"import { extends as _extends, objectWithoutPropertiesLoose as _objectWithoutPropertiesLoose } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport React, { useReducer, createRef, useMemo, createContext, useCallback, useEffect, useRef, useContext, Fragment } from 'react';\nimport { match } from '../../utils/match.esm.js';\nimport { render, forwardRefWithAs, Features } from '../../utils/render.esm.js';\nimport { useSyncRefs } from '../../hooks/use-sync-refs.esm.js';\nimport { Keys } from '../keyboard.esm.js';\nimport { isDisabledReactIssue7711 } from '../../utils/bugs.esm.js';\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect.esm.js';\nimport { useId } from '../../hooks/use-id.esm.js';\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management.esm.js';\nimport { useWindowEvent } from '../../hooks/use-window-event.esm.js';\nimport { OpenClosedProvider, State, useOpenClosed } from '../../internal/open-closed.esm.js';\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type.esm.js';\nimport { disposables } from '../../utils/disposables.esm.js';\nimport { useDisposables } from '../../hooks/use-disposables.esm.js';\nimport { calculateActiveIndex, Focus } from '../../utils/calculate-active-index.esm.js';\nimport { useTreeWalker } from '../../hooks/use-tree-walker.esm.js';\nvar _reducers;\nvar MenuStates;\n(function (MenuStates) {\n  MenuStates[MenuStates[\"Open\"] = 0] = \"Open\";\n  MenuStates[MenuStates[\"Closed\"] = 1] = \"Closed\";\n})(MenuStates || (MenuStates = {}));\nvar ActionTypes;\n(function (ActionTypes) {\n  ActionTypes[ActionTypes[\"OpenMenu\"] = 0] = \"OpenMenu\";\n  ActionTypes[ActionTypes[\"CloseMenu\"] = 1] = \"CloseMenu\";\n  ActionTypes[ActionTypes[\"GoToItem\"] = 2] = \"GoToItem\";\n  ActionTypes[ActionTypes[\"Search\"] = 3] = \"Search\";\n  ActionTypes[ActionTypes[\"ClearSearch\"] = 4] = \"ClearSearch\";\n  ActionTypes[ActionTypes[\"RegisterItem\"] = 5] = \"RegisterItem\";\n  ActionTypes[ActionTypes[\"UnregisterItem\"] = 6] = \"UnregisterItem\";\n})(ActionTypes || (ActionTypes = {}));\nvar reducers = (_reducers = {}, _reducers[ActionTypes.CloseMenu] = function (state) {\n  if (state.menuState === MenuStates.Closed) return state;\n  return _extends({}, state, {\n    activeItemIndex: null,\n    menuState: MenuStates.Closed\n  });\n}, _reducers[ActionTypes.OpenMenu] = function (state) {\n  if (state.menuState === MenuStates.Open) return state;\n  return _extends({}, state, {\n    menuState: MenuStates.Open\n  });\n}, _reducers[ActionTypes.GoToItem] = function (state, action) {\n  var activeItemIndex = calculateActiveIndex(action, {\n    resolveItems: function resolveItems() {\n      return state.items;\n    },\n    resolveActiveIndex: function resolveActiveIndex() {\n      return state.activeItemIndex;\n    },\n    resolveId: function resolveId(item) {\n      return item.id;\n    },\n    resolveDisabled: function resolveDisabled(item) {\n      return item.dataRef.current.disabled;\n    }\n  });\n  if (state.searchQuery === '' && state.activeItemIndex === activeItemIndex) return state;\n  return _extends({}, state, {\n    searchQuery: '',\n    activeItemIndex: activeItemIndex\n  });\n}, _reducers[ActionTypes.Search] = function (state, action) {\n  var searchQuery = state.searchQuery + action.value.toLowerCase();\n  var match = state.items.findIndex(function (item) {\n    var _item$dataRef$current;\n    return ((_item$dataRef$current = item.dataRef.current.textValue) == null ? void 0 : _item$dataRef$current.startsWith(searchQuery)) && !item.dataRef.current.disabled;\n  });\n  if (match === -1 || match === state.activeItemIndex) return _extends({}, state, {\n    searchQuery: searchQuery\n  });\n  return _extends({}, state, {\n    searchQuery: searchQuery,\n    activeItemIndex: match\n  });\n}, _reducers[ActionTypes.ClearSearch] = function (state) {\n  if (state.searchQuery === '') return state;\n  return _extends({}, state, {\n    searchQuery: ''\n  });\n}, _reducers[ActionTypes.RegisterItem] = function (state, action) {\n  return _extends({}, state, {\n    items: [].concat(state.items, [{\n      id: action.id,\n      dataRef: action.dataRef\n    }])\n  });\n}, _reducers[ActionTypes.UnregisterItem] = function (state, action) {\n  var nextItems = state.items.slice();\n  var currentActiveItem = state.activeItemIndex !== null ? nextItems[state.activeItemIndex] : null;\n  var idx = nextItems.findIndex(function (a) {\n    return a.id === action.id;\n  });\n  if (idx !== -1) nextItems.splice(idx, 1);\n  return _extends({}, state, {\n    items: nextItems,\n    activeItemIndex: function () {\n      if (idx === state.activeItemIndex) return null;\n      if (currentActiveItem === null) return null; // If we removed the item before the actual active index, then it would be out of sync. To\n      // fix this, we will find the correct (new) index position.\n\n      return nextItems.indexOf(currentActiveItem);\n    }()\n  });\n}, _reducers);\nvar MenuContext = /*#__PURE__*/createContext(null);\nMenuContext.displayName = 'MenuContext';\nfunction useMenuContext(component) {\n  var context = useContext(MenuContext);\n  if (context === null) {\n    var err = new Error(\"<\" + component + \" /> is missing a parent <\" + Menu.name + \" /> component.\");\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useMenuContext);\n    throw err;\n  }\n  return context;\n}\nfunction stateReducer(state, action) {\n  return match(action.type, reducers, state, action);\n} // ---\n\nvar DEFAULT_MENU_TAG = Fragment;\nfunction Menu(props) {\n  var _match;\n  var reducerBag = useReducer(stateReducer, {\n    menuState: MenuStates.Closed,\n    buttonRef: createRef(),\n    itemsRef: createRef(),\n    items: [],\n    searchQuery: '',\n    activeItemIndex: null\n  });\n  var _reducerBag$ = reducerBag[0],\n    menuState = _reducerBag$.menuState,\n    itemsRef = _reducerBag$.itemsRef,\n    buttonRef = _reducerBag$.buttonRef,\n    dispatch = reducerBag[1]; // Handle outside click\n\n  useWindowEvent('mousedown', function (event) {\n    var _buttonRef$current, _itemsRef$current;\n    var target = event.target;\n    if (menuState !== MenuStates.Open) return;\n    if ((_buttonRef$current = buttonRef.current) == null ? void 0 : _buttonRef$current.contains(target)) return;\n    if ((_itemsRef$current = itemsRef.current) == null ? void 0 : _itemsRef$current.contains(target)) return;\n    dispatch({\n      type: ActionTypes.CloseMenu\n    });\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      var _buttonRef$current2;\n      event.preventDefault();\n      (_buttonRef$current2 = buttonRef.current) == null ? void 0 : _buttonRef$current2.focus();\n    }\n  });\n  var slot = useMemo(function () {\n    return {\n      open: menuState === MenuStates.Open\n    };\n  }, [menuState]);\n  return React.createElement(MenuContext.Provider, {\n    value: reducerBag\n  }, React.createElement(OpenClosedProvider, {\n    value: match(menuState, (_match = {}, _match[MenuStates.Open] = State.Open, _match[MenuStates.Closed] = State.Closed, _match))\n  }, render({\n    props: props,\n    slot: slot,\n    defaultTag: DEFAULT_MENU_TAG,\n    name: 'Menu'\n  })));\n} // ---\n\nvar DEFAULT_BUTTON_TAG = 'button';\nvar Button = /*#__PURE__*/forwardRefWithAs(function Button(props, ref) {\n  var _state$itemsRef$curre;\n  var _useMenuContext = useMenuContext([Menu.name, Button.name].join('.')),\n    state = _useMenuContext[0],\n    dispatch = _useMenuContext[1];\n  var buttonRef = useSyncRefs(state.buttonRef, ref);\n  var id = \"headlessui-menu-button-\" + useId();\n  var d = useDisposables();\n  var handleKeyDown = useCallback(function (event) {\n    switch (event.key) {\n      // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n      case Keys.Space:\n      case Keys.Enter:\n      case Keys.ArrowDown:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.OpenMenu\n        });\n        d.nextFrame(function () {\n          return dispatch({\n            type: ActionTypes.GoToItem,\n            focus: Focus.First\n          });\n        });\n        break;\n      case Keys.ArrowUp:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.OpenMenu\n        });\n        d.nextFrame(function () {\n          return dispatch({\n            type: ActionTypes.GoToItem,\n            focus: Focus.Last\n          });\n        });\n        break;\n    }\n  }, [dispatch, d]);\n  var handleKeyUp = useCallback(function (event) {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault();\n        break;\n    }\n  }, []);\n  var handleClick = useCallback(function (event) {\n    if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault();\n    if (props.disabled) return;\n    if (state.menuState === MenuStates.Open) {\n      dispatch({\n        type: ActionTypes.CloseMenu\n      });\n      d.nextFrame(function () {\n        var _state$buttonRef$curr;\n        return (_state$buttonRef$curr = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr.focus({\n          preventScroll: true\n        });\n      });\n    } else {\n      event.preventDefault();\n      event.stopPropagation();\n      dispatch({\n        type: ActionTypes.OpenMenu\n      });\n    }\n  }, [dispatch, d, state, props.disabled]);\n  var slot = useMemo(function () {\n    return {\n      open: state.menuState === MenuStates.Open\n    };\n  }, [state]);\n  var passthroughProps = props;\n  var propsWeControl = {\n    ref: buttonRef,\n    id: id,\n    type: useResolveButtonType(props, state.buttonRef),\n    'aria-haspopup': true,\n    'aria-controls': (_state$itemsRef$curre = state.itemsRef.current) == null ? void 0 : _state$itemsRef$curre.id,\n    'aria-expanded': props.disabled ? undefined : state.menuState === MenuStates.Open,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick\n  };\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Menu.Button'\n  });\n}); // ---\n\nvar DEFAULT_ITEMS_TAG = 'div';\nvar ItemsRenderFeatures = Features.RenderStrategy | Features.Static;\nvar Items = /*#__PURE__*/forwardRefWithAs(function Items(props, ref) {\n  var _state$items$state$ac, _state$buttonRef$curr4;\n  var _useMenuContext2 = useMenuContext([Menu.name, Items.name].join('.')),\n    state = _useMenuContext2[0],\n    dispatch = _useMenuContext2[1];\n  var itemsRef = useSyncRefs(state.itemsRef, ref);\n  var id = \"headlessui-menu-items-\" + useId();\n  var searchDisposables = useDisposables();\n  var usesOpenClosedState = useOpenClosed();\n  var visible = function () {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open;\n    }\n    return state.menuState === MenuStates.Open;\n  }();\n  useEffect(function () {\n    var container = state.itemsRef.current;\n    if (!container) return;\n    if (state.menuState !== MenuStates.Open) return;\n    if (container === document.activeElement) return;\n    container.focus({\n      preventScroll: true\n    });\n  }, [state.menuState, state.itemsRef]);\n  useTreeWalker({\n    container: state.itemsRef.current,\n    enabled: state.menuState === MenuStates.Open,\n    accept: function accept(node) {\n      if (node.getAttribute('role') === 'menuitem') return NodeFilter.FILTER_REJECT;\n      if (node.hasAttribute('role')) return NodeFilter.FILTER_SKIP;\n      return NodeFilter.FILTER_ACCEPT;\n    },\n    walk: function walk(node) {\n      node.setAttribute('role', 'none');\n    }\n  });\n  var handleKeyDown = useCallback(function (event) {\n    searchDisposables.dispose();\n    switch (event.key) {\n      // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n      // @ts-expect-error Fallthrough is expected here\n      case Keys.Space:\n        if (state.searchQuery !== '') {\n          event.preventDefault();\n          event.stopPropagation();\n          return dispatch({\n            type: ActionTypes.Search,\n            value: event.key\n          });\n        }\n\n      // When in type ahead mode, fallthrough\n\n      case Keys.Enter:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.CloseMenu\n        });\n        if (state.activeItemIndex !== null) {\n          var _document$getElementB;\n          var _id = state.items[state.activeItemIndex].id;\n          (_document$getElementB = document.getElementById(_id)) == null ? void 0 : _document$getElementB.click();\n        }\n        disposables().nextFrame(function () {\n          var _state$buttonRef$curr2;\n          return (_state$buttonRef$curr2 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr2.focus({\n            preventScroll: true\n          });\n        });\n        break;\n      case Keys.ArrowDown:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.Next\n        });\n      case Keys.ArrowUp:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.Previous\n        });\n      case Keys.Home:\n      case Keys.PageUp:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.First\n        });\n      case Keys.End:\n      case Keys.PageDown:\n        event.preventDefault();\n        event.stopPropagation();\n        return dispatch({\n          type: ActionTypes.GoToItem,\n          focus: Focus.Last\n        });\n      case Keys.Escape:\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch({\n          type: ActionTypes.CloseMenu\n        });\n        disposables().nextFrame(function () {\n          var _state$buttonRef$curr3;\n          return (_state$buttonRef$curr3 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr3.focus({\n            preventScroll: true\n          });\n        });\n        break;\n      case Keys.Tab:\n        event.preventDefault();\n        event.stopPropagation();\n        break;\n      default:\n        if (event.key.length === 1) {\n          dispatch({\n            type: ActionTypes.Search,\n            value: event.key\n          });\n          searchDisposables.setTimeout(function () {\n            return dispatch({\n              type: ActionTypes.ClearSearch\n            });\n          }, 350);\n        }\n        break;\n    }\n  }, [dispatch, searchDisposables, state]);\n  var handleKeyUp = useCallback(function (event) {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault();\n        break;\n    }\n  }, []);\n  var slot = useMemo(function () {\n    return {\n      open: state.menuState === MenuStates.Open\n    };\n  }, [state]);\n  var propsWeControl = {\n    'aria-activedescendant': state.activeItemIndex === null ? undefined : (_state$items$state$ac = state.items[state.activeItemIndex]) == null ? void 0 : _state$items$state$ac.id,\n    'aria-labelledby': (_state$buttonRef$curr4 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr4.id,\n    id: id,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    role: 'menu',\n    tabIndex: 0,\n    ref: itemsRef\n  };\n  var passthroughProps = props;\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_ITEMS_TAG,\n    features: ItemsRenderFeatures,\n    visible: visible,\n    name: 'Menu.Items'\n  });\n}); // ---\n\nvar DEFAULT_ITEM_TAG = Fragment;\nfunction Item(props) {\n  var _props$disabled = props.disabled,\n    disabled = _props$disabled === void 0 ? false : _props$disabled,\n    onClick = props.onClick,\n    passthroughProps = _objectWithoutPropertiesLoose(props, [\"disabled\", \"onClick\"]);\n  var _useMenuContext3 = useMenuContext([Menu.name, Item.name].join('.')),\n    state = _useMenuContext3[0],\n    dispatch = _useMenuContext3[1];\n  var id = \"headlessui-menu-item-\" + useId();\n  var active = state.activeItemIndex !== null ? state.items[state.activeItemIndex].id === id : false;\n  useIsoMorphicEffect(function () {\n    if (state.menuState !== MenuStates.Open) return;\n    if (!active) return;\n    var d = disposables();\n    d.nextFrame(function () {\n      var _document$getElementB2;\n      return (_document$getElementB2 = document.getElementById(id)) == null ? void 0 : _document$getElementB2.scrollIntoView == null ? void 0 : _document$getElementB2.scrollIntoView({\n        block: 'nearest'\n      });\n    });\n    return d.dispose;\n  }, [id, active, state.menuState]);\n  var bag = useRef({\n    disabled: disabled\n  });\n  useIsoMorphicEffect(function () {\n    bag.current.disabled = disabled;\n  }, [bag, disabled]);\n  useIsoMorphicEffect(function () {\n    var _document$getElementB3, _document$getElementB4;\n    bag.current.textValue = (_document$getElementB3 = document.getElementById(id)) == null ? void 0 : (_document$getElementB4 = _document$getElementB3.textContent) == null ? void 0 : _document$getElementB4.toLowerCase();\n  }, [bag, id]);\n  useIsoMorphicEffect(function () {\n    dispatch({\n      type: ActionTypes.RegisterItem,\n      id: id,\n      dataRef: bag\n    });\n    return function () {\n      return dispatch({\n        type: ActionTypes.UnregisterItem,\n        id: id\n      });\n    };\n  }, [bag, id]);\n  var handleClick = useCallback(function (event) {\n    if (disabled) return event.preventDefault();\n    dispatch({\n      type: ActionTypes.CloseMenu\n    });\n    disposables().nextFrame(function () {\n      var _state$buttonRef$curr5;\n      return (_state$buttonRef$curr5 = state.buttonRef.current) == null ? void 0 : _state$buttonRef$curr5.focus({\n        preventScroll: true\n      });\n    });\n    if (onClick) return onClick(event);\n  }, [dispatch, state.buttonRef, disabled, onClick]);\n  var handleFocus = useCallback(function () {\n    if (disabled) return dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Nothing\n    });\n    dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Specific,\n      id: id\n    });\n  }, [disabled, id, dispatch]);\n  var handleMove = useCallback(function () {\n    if (disabled) return;\n    if (active) return;\n    dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Specific,\n      id: id\n    });\n  }, [disabled, active, id, dispatch]);\n  var handleLeave = useCallback(function () {\n    if (disabled) return;\n    if (!active) return;\n    dispatch({\n      type: ActionTypes.GoToItem,\n      focus: Focus.Nothing\n    });\n  }, [disabled, active, dispatch]);\n  var slot = useMemo(function () {\n    return {\n      active: active,\n      disabled: disabled\n    };\n  }, [active, disabled]);\n  var propsWeControl = {\n    id: id,\n    role: 'menuitem',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    disabled: undefined,\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave\n  };\n  return render({\n    props: _extends({}, passthroughProps, propsWeControl),\n    slot: slot,\n    defaultTag: DEFAULT_ITEM_TAG,\n    name: 'Menu.Item'\n  });\n} // ---\n\nMenu.Button = Button;\nMenu.Items = Items;\nMenu.Item = Item;\nexport { Menu };","map":{"version":3,"sources":["/Users/prince.kumar/Documents/Niyo-Dev/Games/travel-wordle/truddle/node_modules/@headlessui/react/src/components/menu/menu.tsx"],"names":["MenuStates","ActionTypes","reducers","CloseMenu","state","menuState","Closed","activeItemIndex","OpenMenu","Open","GoToItem","action","calculateActiveIndex","resolveItems","items","resolveActiveIndex","resolveId","item","id","resolveDisabled","dataRef","current","disabled","searchQuery","Search","value","toLowerCase","match","findIndex","textValue","startsWith","ClearSearch","RegisterItem","UnregisterItem","nextItems","slice","currentActiveItem","idx","a","splice","indexOf","MenuContext","createContext","displayName","useMenuContext","component","context","useContext","err","Error","Menu","name","captureStackTrace","stateReducer","type","DEFAULT_MENU_TAG","Fragment","props","reducerBag","useReducer","buttonRef","createRef","itemsRef","dispatch","useWindowEvent","target","event","contains","isFocusableElement","FocusableMode","Loose","preventDefault","focus","slot","useMemo","open","Provider","OpenClosedProvider","State","render","defaultTag","DEFAULT_BUTTON_TAG","Button","forwardRefWithAs","ref","join","useSyncRefs","useId","d","useDisposables","handleKeyDown","useCallback","key","Keys","Space","Enter","ArrowDown","stopPropagation","nextFrame","Focus","First","ArrowUp","Last","handleKeyUp","handleClick","isDisabledReactIssue7711","currentTarget","preventScroll","passthroughProps","propsWeControl","useResolveButtonType","undefined","onKeyDown","onKeyUp","onClick","DEFAULT_ITEMS_TAG","ItemsRenderFeatures","Features","RenderStrategy","Static","Items","searchDisposables","usesOpenClosedState","useOpenClosed","visible","useEffect","container","document","activeElement","useTreeWalker","enabled","accept","node","getAttribute","NodeFilter","FILTER_REJECT","hasAttribute","FILTER_SKIP","FILTER_ACCEPT","walk","setAttribute","dispose","getElementById","click","disposables","Next","Previous","Home","PageUp","End","PageDown","Escape","Tab","length","setTimeout","role","tabIndex","features","DEFAULT_ITEM_TAG","Item","active","useIsoMorphicEffect","scrollIntoView","block","bag","useRef","textContent","handleFocus","Nothing","Specific","handleMove","handleLeave","onFocus","onPointerMove","onMouseMove","onPointerLeave","onMouseLeave"],"mappings":"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","sourcesContent":["// WAI-ARIA: https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\nimport React, {\n  Fragment,\n  createContext,\n  createRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n\n  // Types\n  Dispatch,\n  ElementType,\n  KeyboardEvent as ReactKeyboardEvent,\n  MouseEvent as ReactMouseEvent,\n  MutableRefObject,\n  Ref,\n} from 'react'\n\nimport { Props } from '../../types'\nimport { match } from '../../utils/match'\nimport { forwardRefWithAs, render, Features, PropsForFeatures } from '../../utils/render'\nimport { disposables } from '../../utils/disposables'\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { useId } from '../../hooks/use-id'\nimport { Keys } from '../keyboard'\nimport { Focus, calculateActiveIndex } from '../../utils/calculate-active-index'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management'\nimport { useWindowEvent } from '../../hooks/use-window-event'\nimport { useTreeWalker } from '../../hooks/use-tree-walker'\nimport { useOpenClosed, State, OpenClosedProvider } from '../../internal/open-closed'\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type'\n\nenum MenuStates {\n  Open,\n  Closed,\n}\n\ntype MenuItemDataRef = MutableRefObject<{ textValue?: string; disabled: boolean }>\n\ninterface StateDefinition {\n  menuState: MenuStates\n  buttonRef: MutableRefObject<HTMLButtonElement | null>\n  itemsRef: MutableRefObject<HTMLDivElement | null>\n  items: { id: string; dataRef: MenuItemDataRef }[]\n  searchQuery: string\n  activeItemIndex: number | null\n}\n\nenum ActionTypes {\n  OpenMenu,\n  CloseMenu,\n\n  GoToItem,\n  Search,\n  ClearSearch,\n  RegisterItem,\n  UnregisterItem,\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseMenu }\n  | { type: ActionTypes.OpenMenu }\n  | { type: ActionTypes.GoToItem; focus: Focus.Specific; id: string }\n  | { type: ActionTypes.GoToItem; focus: Exclude<Focus, Focus.Specific> }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterItem; id: string; dataRef: MenuItemDataRef }\n  | { type: ActionTypes.UnregisterItem; id: string }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseMenu](state) {\n    if (state.menuState === MenuStates.Closed) return state\n    return { ...state, activeItemIndex: null, menuState: MenuStates.Closed }\n  },\n  [ActionTypes.OpenMenu](state) {\n    if (state.menuState === MenuStates.Open) return state\n    return { ...state, menuState: MenuStates.Open }\n  },\n  [ActionTypes.GoToItem]: (state, action) => {\n    let activeItemIndex = calculateActiveIndex(action, {\n      resolveItems: () => state.items,\n      resolveActiveIndex: () => state.activeItemIndex,\n      resolveId: item => item.id,\n      resolveDisabled: item => item.dataRef.current.disabled,\n    })\n\n    if (state.searchQuery === '' && state.activeItemIndex === activeItemIndex) return state\n    return { ...state, searchQuery: '', activeItemIndex }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    let searchQuery = state.searchQuery + action.value.toLowerCase()\n    let match = state.items.findIndex(\n      item =>\n        item.dataRef.current.textValue?.startsWith(searchQuery) && !item.dataRef.current.disabled\n    )\n\n    if (match === -1 || match === state.activeItemIndex) return { ...state, searchQuery }\n    return { ...state, searchQuery, activeItemIndex: match }\n  },\n  [ActionTypes.ClearSearch](state) {\n    if (state.searchQuery === '') return state\n    return { ...state, searchQuery: '' }\n  },\n  [ActionTypes.RegisterItem]: (state, action) => ({\n    ...state,\n    items: [...state.items, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterItem]: (state, action) => {\n    let nextItems = state.items.slice()\n    let currentActiveItem = state.activeItemIndex !== null ? nextItems[state.activeItemIndex] : null\n\n    let idx = nextItems.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextItems.splice(idx, 1)\n\n    return {\n      ...state,\n      items: nextItems,\n      activeItemIndex: (() => {\n        if (idx === state.activeItemIndex) return null\n        if (currentActiveItem === null) return null\n\n        // If we removed the item before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextItems.indexOf(currentActiveItem)\n      })(),\n    }\n  },\n}\n\nlet MenuContext = createContext<[StateDefinition, Dispatch<Actions>] | null>(null)\nMenuContext.displayName = 'MenuContext'\n\nfunction useMenuContext(component: string) {\n  let context = useContext(MenuContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Menu.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useMenuContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_MENU_TAG = Fragment\ninterface MenuRenderPropArg {\n  open: boolean\n}\n\nexport function Menu<TTag extends ElementType = typeof DEFAULT_MENU_TAG>(\n  props: Props<TTag, MenuRenderPropArg>\n) {\n  let reducerBag = useReducer(stateReducer, {\n    menuState: MenuStates.Closed,\n    buttonRef: createRef(),\n    itemsRef: createRef(),\n    items: [],\n    searchQuery: '',\n    activeItemIndex: null,\n  } as StateDefinition)\n  let [{ menuState, itemsRef, buttonRef }, dispatch] = reducerBag\n\n  // Handle outside click\n  useWindowEvent('mousedown', event => {\n    let target = event.target as HTMLElement\n\n    if (menuState !== MenuStates.Open) return\n\n    if (buttonRef.current?.contains(target)) return\n    if (itemsRef.current?.contains(target)) return\n\n    dispatch({ type: ActionTypes.CloseMenu })\n\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      event.preventDefault()\n      buttonRef.current?.focus()\n    }\n  })\n\n  let slot = useMemo<MenuRenderPropArg>(() => ({ open: menuState === MenuStates.Open }), [\n    menuState,\n  ])\n\n  return (\n    <MenuContext.Provider value={reducerBag}>\n      <OpenClosedProvider\n        value={match(menuState, {\n          [MenuStates.Open]: State.Open,\n          [MenuStates.Closed]: State.Closed,\n        })}\n      >\n        {render({ props, slot, defaultTag: DEFAULT_MENU_TAG, name: 'Menu' })}\n      </OpenClosedProvider>\n    </MenuContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_BUTTON_TAG = 'button' as const\ninterface ButtonRenderPropArg {\n  open: boolean\n}\ntype ButtonPropsWeControl =\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'onKeyDown'\n  | 'onClick'\n\nlet Button = forwardRefWithAs(function Button<TTag extends ElementType = typeof DEFAULT_BUTTON_TAG>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: Ref<HTMLButtonElement>\n) {\n  let [state, dispatch] = useMenuContext([Menu.name, Button.name].join('.'))\n  let buttonRef = useSyncRefs(state.buttonRef, ref)\n\n  let id = `headlessui-menu-button-${useId()}`\n  let d = useDisposables()\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => dispatch({ type: ActionTypes.GoToItem, focus: Focus.First }))\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => dispatch({ type: ActionTypes.GoToItem, focus: Focus.Last }))\n          break\n      }\n    },\n    [dispatch, d]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      if (props.disabled) return\n      if (state.menuState === MenuStates.Open) {\n        dispatch({ type: ActionTypes.CloseMenu })\n        d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      } else {\n        event.preventDefault()\n        event.stopPropagation()\n        dispatch({ type: ActionTypes.OpenMenu })\n      }\n    },\n    [dispatch, d, state, props.disabled]\n  )\n\n  let slot = useMemo<ButtonRenderPropArg>(() => ({ open: state.menuState === MenuStates.Open }), [\n    state,\n  ])\n  let passthroughProps = props\n  let propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: useResolveButtonType(props, state.buttonRef),\n    'aria-haspopup': true,\n    'aria-controls': state.itemsRef.current?.id,\n    'aria-expanded': props.disabled ? undefined : state.menuState === MenuStates.Open,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Menu.Button',\n  })\n})\n\n// ---\n\nlet DEFAULT_ITEMS_TAG = 'div' as const\ninterface ItemsRenderPropArg {\n  open: boolean\n}\ntype ItemsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'id'\n  | 'onKeyDown'\n  | 'role'\n  | 'tabIndex'\n\nlet ItemsRenderFeatures = Features.RenderStrategy | Features.Static\n\nlet Items = forwardRefWithAs(function Items<TTag extends ElementType = typeof DEFAULT_ITEMS_TAG>(\n  props: Props<TTag, ItemsRenderPropArg, ItemsPropsWeControl> &\n    PropsForFeatures<typeof ItemsRenderFeatures>,\n  ref: Ref<HTMLDivElement>\n) {\n  let [state, dispatch] = useMenuContext([Menu.name, Items.name].join('.'))\n  let itemsRef = useSyncRefs(state.itemsRef, ref)\n\n  let id = `headlessui-menu-items-${useId()}`\n  let searchDisposables = useDisposables()\n\n  let usesOpenClosedState = useOpenClosed()\n  let visible = (() => {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open\n    }\n\n    return state.menuState === MenuStates.Open\n  })()\n\n  useEffect(() => {\n    let container = state.itemsRef.current\n    if (!container) return\n    if (state.menuState !== MenuStates.Open) return\n    if (container === document.activeElement) return\n\n    container.focus({ preventScroll: true })\n  }, [state.menuState, state.itemsRef])\n\n  useTreeWalker({\n    container: state.itemsRef.current,\n    enabled: state.menuState === MenuStates.Open,\n    accept(node) {\n      if (node.getAttribute('role') === 'menuitem') return NodeFilter.FILTER_REJECT\n      if (node.hasAttribute('role')) return NodeFilter.FILTER_SKIP\n      return NodeFilter.FILTER_ACCEPT\n    },\n    walk(node) {\n      node.setAttribute('role', 'none')\n    },\n  })\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLDivElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            event.stopPropagation()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseMenu })\n          if (state.activeItemIndex !== null) {\n            let { id } = state.items[state.activeItemIndex]\n            document.getElementById(id)?.click()\n          }\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.ArrowDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Next })\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Previous })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.First })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Last })\n\n        case Keys.Escape:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseMenu })\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.Tab:\n          event.preventDefault()\n          event.stopPropagation()\n          break\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [dispatch, searchDisposables, state]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let slot = useMemo<ItemsRenderPropArg>(() => ({ open: state.menuState === MenuStates.Open }), [\n    state,\n  ])\n  let propsWeControl = {\n    'aria-activedescendant':\n      state.activeItemIndex === null ? undefined : state.items[state.activeItemIndex]?.id,\n    'aria-labelledby': state.buttonRef.current?.id,\n    id,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    role: 'menu',\n    tabIndex: 0,\n    ref: itemsRef,\n  }\n  let passthroughProps = props\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_ITEMS_TAG,\n    features: ItemsRenderFeatures,\n    visible,\n    name: 'Menu.Items',\n  })\n})\n\n// ---\n\nlet DEFAULT_ITEM_TAG = Fragment\ninterface ItemRenderPropArg {\n  active: boolean\n  disabled: boolean\n}\ntype MenuItemPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'onPointerLeave'\n  | 'onPointerMove'\n  | 'onMouseLeave'\n  | 'onMouseMove'\n  | 'onFocus'\n\nfunction Item<TTag extends ElementType = typeof DEFAULT_ITEM_TAG>(\n  props: Props<TTag, ItemRenderPropArg, MenuItemPropsWeControl> & {\n    disabled?: boolean\n    onClick?: (event: { preventDefault: Function }) => void\n  }\n) {\n  let { disabled = false, onClick, ...passthroughProps } = props\n  let [state, dispatch] = useMenuContext([Menu.name, Item.name].join('.'))\n  let id = `headlessui-menu-item-${useId()}`\n  let active = state.activeItemIndex !== null ? state.items[state.activeItemIndex].id === id : false\n\n  useIsoMorphicEffect(() => {\n    if (state.menuState !== MenuStates.Open) return\n    if (!active) return\n    let d = disposables()\n    d.nextFrame(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    return d.dispose\n  }, [id, active, state.menuState])\n\n  let bag = useRef<MenuItemDataRef['current']>({ disabled })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterItem, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterItem, id })\n  }, [bag, id])\n\n  let handleClick = useCallback(\n    (event: MouseEvent) => {\n      if (disabled) return event.preventDefault()\n      dispatch({ type: ActionTypes.CloseMenu })\n      disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      if (onClick) return onClick(event)\n    },\n    [dispatch, state.buttonRef, disabled, onClick]\n  )\n\n  let handleFocus = useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Specific, id })\n  }, [disabled, id, dispatch])\n\n  let handleMove = useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Specific, id })\n  }, [disabled, active, id, dispatch])\n\n  let handleLeave = useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  let slot = useMemo<ItemRenderPropArg>(() => ({ active, disabled }), [active, disabled])\n  let propsWeControl = {\n    id,\n    role: 'menuitem',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    disabled: undefined, // Never forward the `disabled` prop\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_ITEM_TAG,\n    name: 'Menu.Item',\n  })\n}\n\n// ---\n\nMenu.Button = Button\nMenu.Items = Items\nMenu.Item = Item\n"]},"metadata":{},"sourceType":"module"}